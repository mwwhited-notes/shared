@startuml System Architecture Overview
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Helvetica
skinparam defaultFontSize 11
skinparam roundCorners 8

title Synchronized Telemetry Streaming System Architecture

package "Data Acquisition Layer" {
    component [SCPI Instruments] as instruments
    component [Sensor Networks] as sensors
    component [SDR Receivers] as sdr
}

package "Stream Collection" {
    component [LSL Hub] as lsl
    component [MQTT Broker] as mqtt
    component [NATS Server] as nats
}

package "Event Streaming Platform" {
    component [Kafka Cluster] as kafka
    component [NATS JetStream] as jetstream
    component [RabbitMQ] as rabbitmq
}

package "Processing and Analysis" {
    component [Stream Processor Flink] as processor
    component [Time Correlation Engine] as correlator
    component [RaptorQ Decoder] as decoder
}

package "Time Synchronization" {
    component [NTP Server] as ntp
    component [PTP Master] as ptp
    component [GPS Receiver] as gps
}

package "Storage and Persistence" {
    database [InfluxDB TimeSeries] as influxdb
    database [TimescaleDB PostgreSQL] as timescaledb
    database [HDF5 Files] as hdf5
    database [S3 Blob Storage] as s3
}

package "Visualization and Alerting" {
    component [Grafana Dashboards] as grafana
    component [Alert Manager] as alerts
    component [Prometheus] as prometheus
}

' Data Flow
instruments --> lsl
sensors --> lsl
sdr --> lsl

lsl --> kafka
mqtt --> kafka
nats --> kafka

kafka --> processor
kafka --> decoder

processor --> influxdb
processor --> timescaledb
decoder --> s3

processor --> correlator
ntp ..> processor
ptp ..> processor
gps ..> correlator

influxdb --> grafana
timescaledb --> grafana
prometheus --> grafana

processor --> prometheus
alerts --> grafana

note right of lsl
  Lab Streaming Layer
  Multi-modal data
  Synchronized timestamps
  Sample rate Hz to kHz
end note

note right of kafka
  Event Streaming Hub
  CloudEvents envelope
  Topic-based routing
  Partition by sensor ID
end note

note right of processor
  Real-time Processing
  Stateful operations
  Event-time semantics
  Late data handling
end note

note right of influxdb
  High-cardinality timeseries
  Tag-based indexing
  Compression enabled
  Retention policies
end note

@enduml
