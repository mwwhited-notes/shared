@startuml Protocol Selection Decision Tree
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Helvetica
skinparam defaultFontSize 11
skinparam linetype ortho

title Telemetry System Protocol Selection Decision Tree

start

:Primary Requirement?;

if (Real-time Local Lab?) then (Yes)
    :Use **LSL (Lab Streaming Layer)**;
    :Multi-modal, low-latency <1ms synchronization;
    :XDF format (self-documenting);
    end
else (No)
    :Need Network Distribution?;

    if (Yes) then
        :Throughput Requirement?;

        if (High (>10K msgs/sec)) then
            :Message Ordering?;

            if (Critical) then
                :Use **Kafka**;
                :High throughput Partition ordering Reliable delivery 3-9 replicas;
                end
            else (Flexible)
                :Use **NATS**;
                :Lower latency Simpler operations Subject-based;
                end
            endif
        else (Medium 100-10K msgs/sec)
            :Use **NATS JetStream** or **RabbitMQ**;
            :Balanced performance Flexible delivery modes;
            end
        endif
    else (No)
        :Local message queue only?;

        if (Yes) then
            :Use **RabbitMQ** or **MQTT**;
            :Pub/Sub, queue abstractions Durable, fault-tolerant;
            end
        endif
    endif
endif

:Data Transfer Protocol Decision;

:High packet loss (>5%)?;

if (Yes) then
    :Use **RaptorQ** (RFC 6330);
    :Fountain codes No retransmission Optimal for >10% loss;
    :Symbol redundancy: 10-30%;
    :Encoding: O(K²), Decoding: O(K²);
    end
else (No)
    :Packet loss <5%?;

    if (Yes) then
        :Use **QUIC** for streaming or **TCP** for reliable;
        :Built-in error handling Automatic retransmission;
        end
    else (None)
        :Use **UDP** or **RTP**;
        :Best latency No overhead;
        end
    endif
endif

:Storage Format Decision;

:Query Pattern?;

if (Analytics/SQL) then
    :Use **Parquet** + **TimescaleDB**;
    :Columnar format Full SQL support Compression: 80%+;
    end
else if (Time-series Metrics) then
    :Use **InfluxDB**;
    :Tag-based indexing High cardinality Automated downsampling;
    end
else (Offline Processing)
    :Use **HDF5**;
    :Hierarchical structure Efficient arrays Matlab/Python friendly;
    end
endif

:Synchronization Method Decision;

:Precision Required?;

if (µs/ns level) then
    :Use **PTP** (IEEE 1588);
    :Hardware-assisted Cluster-wide sync Accuracy: <1 µs;
    end
else if (ms/100µs) then
    :Use **NTP**;
    :Network-based Global coverage Accuracy: 1-10 ms;
    end
else (Best effort)
    :Use **RTP** or **Application Timestamps**;
    :Simpler, lower overhead;
    end
endif

stop

@enduml
