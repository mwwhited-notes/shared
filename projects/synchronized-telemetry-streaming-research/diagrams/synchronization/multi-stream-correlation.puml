@startuml Multi-Stream Time Synchronization Architecture
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Helvetica
skinparam defaultFontSize 10

title Multi-Receiver Time Synchronization & Correlation

package "Time Source Infrastructure" {
    component [GPS Receiver (PPS output)] as gps
    component [NTP Server (Stratum 1)] as ntp
    component [PTP Master (IEEE 1588v2)] as ptp
}

package "Receiver Devices" {
    component [Receiver 1 (SDR1)] as rx1
    component [Receiver 2 (SDR2)] as rx2
    component [Receiver 3 (Oscilloscope)] as rx3
}

package "Local Oscillator Synchronization" {
    component [GPS Disciplined Oscillator (GPSDO)] as gpsdo
    component [Atomic Clock Reference] as atomic
}

package "Timestamp Correlation Engine" {
    component [NTP Time Sync] as ntp_sync
    component [PTP Sync (Grandmaster)] as ptp_sync
    component [RTP Sync Info] as rtp_sync
}

package "Multi-Receiver Processing" {
    component [TDOA Computation (Time Diff of Arrival)] as tdoa
    component [Cross-Correlation Analysis] as xcorr
    component [Phase Coherence Estimation] as phase
}

package "Data Storage" {
    database [HDF5 with Metadata] as hdf5
    database [Parquet with Timestamp Index] as parquet
}

package "Post-Processing" {
    component [MATLAB/Python Analysis] as analysis
    component [Offline TDOA Solver] as solver
}

' Time sync connections
gps --> gpsdo
gps --> ntp
gps --> ptp

ntp --> ntp_sync
ptp --> ptp_sync

' Receiver synchronization
rx1 ..> gpsdo
rx2 ..> gpsdo
rx3 ..> atomic

' Timestamp correlation
ntp_sync --> tdoa
ptp_sync --> tdoa
rtp_sync --> tdoa

' Data correlation
rx1 --> xcorr
rx2 --> xcorr
rx3 --> xcorr

tdoa --> xcorr
xcorr --> phase

' Storage
xcorr --> hdf5
phase --> parquet

' Analysis
hdf5 --> analysis
parquet --> solver
analysis --> solver

note right of gpsdo
  Time Discipline:
  - GPS 1PPS locked
  - Atomic accuracy
  - Holdover 1 week
  - Phase noise: <-100 dBc
end note

note right of tdoa
  TDOA Algorithm:
  - Measure arrival times
  - Calculate differences
  - Localize sources
  - Accuracy: Î»/2 phase
end note

note right of xcorr
  Cross-Correlation:
  - Peak detection
  - SNR estimation
  - Confidence intervals
  - Jitter measurement
end note

note right of hdf5
  Metadata Storage:
  - NTP offset model
  - PTP grandmaster ID
  - Temperature/humidity
  - Oscillator discipline
  - Clock drift rate
end note

note right of analysis
  Use Cases:
  - Passive radar TDOA
  - Seismic triangulation
  - Radio direction finding
  - Audio localization
  - Distributed sensing
end note

@enduml
